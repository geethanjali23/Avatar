<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Neura AI â€” {{ bot.name if bot else 'Workstation' }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Courier+New:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* --- GLOBAL RESET & BODY --- */
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0;
            background: radial-gradient(circle at center, #0f001f, #050014);
            font-family: "Poppins", sans-serif;
            color: #fff;
            height: 100vh;
            overflow: hidden;
        }

        /* --- NAVBAR --- */
        .navbar {
            width: 100%; padding: 18px 40px;
            display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(20px); background: rgba(255, 255, 255, 0.06);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            position: fixed; top: 0; z-index: 20;
        }
        .nav-left { font-size: 22px; font-weight: 700; color: #82f7ff; text-shadow: 0 0 12px #00fbff; letter-spacing: 1px; }
        .nav-right a { text-decoration: none; margin-left: 22px; color: #ffe4ff; font-weight: 600; font-size: 14px; transition: color 0.3s; }
        .nav-right a:hover { color: #00eaff; }

        /* --- HOLOGRAM AVATAR --- */
        .holo-wrapper {
            position: absolute; top: 14vh; left: 50%;
            transform: translateX(-50%); display: flex; justify-content: center;
        }
        .holo-circle {
            width: 280px; height: 280px; border-radius: 50%;
            border: 3px solid rgba(0, 255, 255, 0.35);
            box-shadow: 0 0 24px #00fff2, inset 0 0 40px rgba(0, 255, 255, 0.7);
            animation: pulse 4s infinite ease-in-out;
            overflow: hidden; position: relative;
            background: rgba(0,0,0,0.3);
        }
        .holo-circle img { 
            width: 100%; height: 100%; object-fit: cover; 
            opacity: .9; filter: drop-shadow(0 0 20px #00fff2); 
        }
        @keyframes pulse { 
            0%, 100% { transform: scale(1); box-shadow: 0 0 24px #00fff2; } 
            50% { transform: scale(1.02); box-shadow: 0 0 40px #00fff2; } 
        }

        /* --- CHAT INTERFACE --- */
        .chat-box {
            position: absolute; width: 60%; height: 38vh;
            bottom: 20vh; left: 50%; transform: translateX(-50%);
            padding: 20px; border-radius: 20px; overflow-y: auto;
            background: rgba(255, 255, 255, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px); scrollbar-width: none;
        }
        .chat-box::-webkit-scrollbar { display: none; }
        
        .bubble { margin: 10px 0; padding: 12px 18px; border-radius: 14px; max-width: 80%; line-height: 1.5; font-size: 14px; animation: fadeIn 0.3s ease; }
        .bubble .meta { font-size: 10px; opacity: .7; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; }
        .you { margin-left: auto; background: linear-gradient(135deg, #00fff2, #008cff); color: #001c29; font-weight: 500; box-shadow: 0 4px 15px rgba(0, 255, 242, 0.2); border-bottom-right-radius: 2px; }
        .assistant { background: rgba(255, 255, 255, 0.1); border-left: 3px solid #bd00ff; border-bottom-left-radius: 2px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CONTROL BAR --- */
        .controls {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 12px; align-items: center;
            padding: 10px 15px; background: rgba(10, 10, 30, 0.8);
            backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 50px; box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            min-width: 650px; z-index: 100;
        }
        .input {
            flex-grow: 1; background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 30px;
            padding: 14px 24px; color: #fff; font-family: "Poppins", sans-serif;
            font-size: 14px; outline: none; transition: all 0.3s ease;
        }
        .input:focus { background: rgba(255, 255, 255, 0.15); border-color: #00eaff; }
        
        button { border: none; cursor: pointer; font-family: "Poppins", sans-serif; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;}
        
        .icon-btn {
            width: 48px; height: 48px; border-radius: 50%; font-size: 20px;
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #micBtn:hover { background: #00eaff; color: #000; box-shadow: 0 0 20px #00eaff; }
        #camBtn:hover { background: #bd00ff; color: #fff; box-shadow: 0 0 20px #bd00ff; }

        #sendBtn {
            background: linear-gradient(135deg, #00eaff, #0077ff);
            color: #001c29; font-weight: 700; padding: 12px 32px;
            border-radius: 30px; font-size: 14px;
        }
        #sendBtn:hover { transform: translateY(-2px); box-shadow: 0 0 25px rgba(0, 234, 255, 0.6); }
        #clearBtn { background: transparent; color: rgba(255, 80, 80, 0.8); font-size: 12px; font-weight: 600; padding: 0 10px; }
        #clearBtn:hover { color: #ff5050; }

        /* --- WORK TIMER WIDGET --- */
        .work-timer {
            position: absolute; bottom: 40px; left: 40px;
            display: flex; flex-direction: column; align-items: center;
            background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px; border-radius: 20px; width: 200px;
            backdrop-filter: blur(14px);
        }
        .work-timer label { font-size: 12px; color: #aaa; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .work-timer select { 
            width: 100%; border-radius: 8px; padding: 8px; border: 1px solid #444; 
            background: #000; color: #fff; margin-bottom: 10px; outline: none;
        }
        #timerStart {
            width: 100%; padding: 10px; border-radius: 10px;
            background: linear-gradient(90deg, #00eaff, #00ff9d); color: #000;
            font-weight: 700; box-shadow: 0 4px 15px rgba(0, 255, 157, 0.2);
        }
        #timerStart:hover { transform: scale(1.05); }

        /* --- SETTINGS BUTTON --- */
        .settings-fab { 
            position: fixed; right: 40px; bottom: 40px; padding: 12px 20px; 
            border-radius: 30px; background: rgba(255, 255, 255, 0.1); 
            border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; 
            backdrop-filter: blur(10px); z-index: 40; font-weight: 600;
        }
        .settings-fab:hover { background: rgba(255, 255, 255, 0.2); }

        /* --- MODALS --- */
        #settingsModal, #breakModal {
            display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85);
            z-index: 200; justify-content: center; align-items: center;
            animation: fadeIn 0.3s;
        }
        .modal-box {
            width: 400px; padding: 30px; background: #0a0a12;
            border-radius: 24px; border: 1px solid #333;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            text-align: left; position: relative;
        }
        .modal-box h2 { margin-top: 0; color: #fff; }
        
        /* Switches */
        .setting-row { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #333; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #00eaff; }
        input:checked + .slider:before { transform: translateX(24px); }

        /* Break Modal Specific */
        #breakModal .modal-box { text-align: center; border: 2px solid #ff0055; background: #1a050a; }
        #breakModal h2 { color: #ff0055; }
        #breakClose {
            margin-top: 20px; background: #ff0055; color: white; 
            border-radius: 10px; padding: 12px 30px; font-weight: bold; width: 100%;
        }

        /* --- CAMERA WIDGET --- */
        .camera-widget {
            position: fixed; right: 40px; bottom: 100px;
            width: 320px; height: 240px; border-radius: 16px;
            background: #000; border: 2px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: translateY(20px); opacity: 0; pointer-events: none;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 35; overflow: hidden; display: flex; flex-direction: column;
        }
        .camera-widget.visible { transform: translateY(0); opacity: 1; pointer-events: auto; border-color: #00eaff; box-shadow: 0 0 20px rgba(0, 234, 255, 0.3); }
        
        /* Circle Mode (PIP) */
        .camera-widget.circle-mode {
            width: 150px !important; height: 150px !important;
            border-radius: 50% !important; border: 3px solid #00eaff;
        }
        .camera-widget.circle-mode .camera-header { display: none; }
        .camera-widget.circle-mode video, .camera-widget.circle-mode canvas { border-radius: 50%; }

        .camera-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 8px 15px; background: rgba(0, 234, 255, 0.1); font-size: 12px; 
        }
        .camera-title { color: #00eaff; font-weight: 700; letter-spacing: 1px; }
        .cam-close { background: none; color: #fff; font-size: 16px; padding: 0; width: auto; height: auto; }
        
        .camera-body { position: relative; flex-grow: 1; width: 100%; height: 100%; background: #000; }
        #cameraFeed, #poseCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        #poseCanvas { z-index: 5; pointer-events: none; }
        
        #camStatus { 
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); 
            background: rgba(0, 0, 0, 0.6); color: #fff; font-size: 10px; 
            padding: 4px 10px; border-radius: 10px; z-index: 10; pointer-events: none; 
            border: 1px solid rgba(255,255,255,0.2); white-space: nowrap;
        }
    </style>
</head>
<body>

    <div class="navbar">
        <!-- DYNAMIC BOT NAME -->
        <div class="nav-left">NEURA â€¢ {{ bot.name if bot else 'AI' }}</div> 
        <div class="nav-right">
            <a href="/dashboard">Dashboard</a>
            <a href="/logout">Logout</a>
        </div>
    </div>

    <div class="holo-wrapper">
        <div id="holo" class="holo-circle">
            <!-- DYNAMIC IMAGE LOGIC: 
                 Uses bot.image_url if available, else falls back to avatar.png 
            -->
            <img src="{{ bot.image_url if bot else url_for('static', filename='img/avatar.png') }}" 
                 alt="AI Avatar" 
                 onerror="this.src='https://i.imgur.com/7u6X2H5.png'"> 
        </div>
    </div>

    <div id="chat" class="chat-box">
        <div class="bubble assistant">
            <div class="meta">{{ bot.name if bot else 'Neura' }}</div>
            <div>System initialized. How can I help you today?</div>
        </div>
    </div>

    <div class="controls">
        <button id="clearBtn">Clear</button>
        <button id="micBtn" class="icon-btn">ðŸŽ¤</button>
        <button id="camBtn" class="icon-btn">ðŸ“·</button>
        <input id="input" class="input" type="text" placeholder="Type a message to Neura...">
        <button id="sendBtn">Send</button>
    </div>

    <div class="work-timer">
        <label>Session Timer</label>
        <select id="timerSelect">
            <option value="0.1">Test (6 sec)</option>
            <option value="25">Pomodoro (25m)</option>
            <option value="45">Deep Work (45m)</option>
            <option value="60">Hour (60m)</option>
        </select>
        <button id="timerStart">Start Focus</button>
    </div>

    <button id="settingsBtn" class="settings-fab">âš™ Settings</button>

    <div id="settingsModal">
        <div class="modal-box">
            <h2>Configuration</h2>
            <p style="color:#888; font-size:13px; margin-bottom:20px;">Customize your workspace behavior.</p>
            
            <div class="setting-row">
                <span>Auto-Listen (Voice Mode)</span>
                <label class="switch">
                    <input type="checkbox" id="autoToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>

            <!-- NEW: Voice Notification Toggle -->
            <div class="setting-row">
                <span>Voice Notifications</span>
                <label class="switch">
                    <input type="checkbox" id="voiceToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-row">
                <span>Posture AI Camera</span>
                <label class="switch">
                    <input type="checkbox" id="cameraToggle">
                    <span class="slider"></span>
                </label>
            </div>

            <button id="closeSettings" style="background: #333; color: white; width: 100%; padding: 12px; border-radius: 12px; margin-top: 10px;">Save & Close</button>
        </div>
    </div>

    <div id="breakModal">
        <div class="modal-box">
            <div style="font-size: 40px; margin-bottom: 10px;">â˜•</div>
            <h2>Session Complete!</h2>
            <p style="color:#ccc; margin-bottom: 20px;">You've worked hard. Please stand up, stretch, and hydrate before continuing.</p>
            <button id="breakClose">I'm Back & Ready</button>
        </div>
    </div>

    <div id="cameraShell" class="camera-widget">
        <div class="camera-header">
            <span class="camera-title">NEURA VISION</span>
            <button id="cameraClose" class="cam-close">âœ•</button>
        </div>
        <div class="camera-body">
            <video id="cameraFeed" autoplay muted playsinline></video>
            <canvas id="poseCanvas"></canvas>
            <div id="camStatus">Initializing...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@0.0.6/dist/pose-detection.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

</body>
</html>